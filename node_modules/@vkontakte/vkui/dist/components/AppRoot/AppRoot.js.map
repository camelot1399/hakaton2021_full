{"version":3,"sources":["../../../src/components/AppRoot/AppRoot.tsx"],"names":["useMemo","useRef","useState","useDOM","classNames","AppRootContext","withAdaptivity","SizeType","useIsomorphicLayoutEffect","classScopingMode","IconSettingsProvider","elementScrollController","globalScrollController","ScrollContext","noop","warnOnce","warn","AppRoot","children","_mode","mode","_embedded","embedded","sizeX","hasMouse","noLegacyClasses","scroll","props","rootRef","portalRoot","setPortalRoot","window","document","initialized","current","documentElement","classList","add","noConflict","process","env","NODE_ENV","portal","createElement","body","appendChild","parentElement","removeChild","parent","classes","concat","remove","REGULAR","container","scrollController","content","appRoot"],"mappings":"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","sourcesContent":["import { FC, HTMLAttributes, useMemo, useRef, useState } from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '../../lib/classNames';\nimport { AppRootContext } from './AppRootContext';\nimport { withAdaptivity, SizeType, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { classScopingMode } from '../../lib/classScopingMode';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext, ScrollContextInterface } from './ScrollContext';\nimport { noop } from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends HTMLAttributes<HTMLDivElement>, AdaptivityProps {\n  /** @deprecated Use mode=\"embedded\" */\n  embedded?: boolean;\n  /** Режим встраивания */\n  mode?: 'partial' | 'embedded' | 'full';\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: 'global' | 'contain';\n}\n\nconst warn = warnOnce('AppRoot');\nconst AppRoot: FC<AppRootProps> = ({\n  children, mode: _mode, embedded: _embedded, sizeX, hasMouse, noLegacyClasses = false, scroll = 'global',\n  ...props\n}) => {\n  // normalize mode\n  const mode = _mode || (_embedded ? 'embedded' : 'full');\n\n  const rootRef = useRef<HTMLDivElement>();\n  const [portalRoot, setPortalRoot] = useState<HTMLDivElement>(null);\n  const { window, document } = useDOM();\n\n  const initialized = useRef(false);\n  if (!initialized.current) {\n    if (window && mode === 'full') {\n      document.documentElement.classList.add('vkui');\n    }\n    classScopingMode.noConflict = noLegacyClasses;\n    initialized.current = true;\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    if (scroll !== 'global' && mode !== 'embedded') {\n      warn('Scroll modes only supported in embedded mode');\n    }\n    if (_mode && _embedded) {\n      warn(`mode=\"${mode}\" overrides embedded`);\n    }\n  }\n\n  // setup portal\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'full') {\n      return noop;\n    }\n\n    const portal = document.createElement('div');\n    portal.classList.add('vkui__portal-root');\n    document.body.appendChild(portal);\n    setPortalRoot(portal);\n    return () => portal.parentElement.removeChild(portal);\n  }, []);\n\n  // setup root classes\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial') {\n      return noop;\n    }\n\n    const parent = rootRef.current.parentElement;\n    const classes = ['vkui__root'].concat(mode === 'embedded' ? 'vkui__root--embedded' : []);\n    parent.classList.add(...classes);\n\n    return () => {\n      parent.classList.remove(...classes);\n      if (mode === 'full') {\n        document.documentElement.classList.remove('vkui');\n      }\n    };\n  }, []);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial' || sizeX !== SizeType.REGULAR) {\n      return noop;\n    }\n    const container = mode === 'embedded' ? rootRef.current.parentElement : document.body;\n    container.classList.add('vkui--sizeX-regular');\n    return () => container.classList.remove('vkui--sizeX-regular');\n  }, [sizeX]);\n\n  const scrollController = useMemo<ScrollContextInterface>(\n    () => scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document),\n    [scroll]);\n\n  const content = (\n    <AppRootContext.Provider value={{\n      appRoot: rootRef,\n      portalRoot: portalRoot,\n      embedded: mode === 'embedded',\n    }}>\n      <ScrollContext.Provider value={scrollController}>\n        <IconSettingsProvider classPrefix=\"vkui\" globalClasses={!noLegacyClasses}>\n          {children}\n        </IconSettingsProvider>\n      </ScrollContext.Provider>\n    </AppRootContext.Provider>\n  );\n\n  return mode === 'partial' ? content : (\n    <div ref={rootRef} vkuiClass={classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse,\n    })} {...props}>\n      {content}\n    </div>\n  );\n};\n\nexport default withAdaptivity(AppRoot, {\n  sizeX: true,\n  hasMouse: true,\n});\n"],"file":"AppRoot.js"}