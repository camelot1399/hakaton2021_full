{"version":3,"sources":["../../../src/components/RangeSlider/UniversalSlider.tsx"],"names":["Component","createRef","Touch","getClassName","classNames","setRef","rescale","withAdaptivity","withPlatform","UniversalSliderDumb","e","props","disabled","boundingRect","container","getBoundingClientRect","containerWidth","width","absolutePosition","startX","left","value","offsetToValue","dragging","snapDirection","originalEvent","target","onChange","updateRange","stopPropagation","shiftX","preventDefault","getRootRef","start","end","absolute","min","max","step","thumbStart","current","thumbEnd","Math","abs","defaultValue","platform","sizeY","restProps","toPercent","v","isRange","draggerStyle","join","onStart","onMove","onEnd","getRef","UniversalSlider"],"mappings":"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","sourcesContent":["import { Component, createRef, HTMLAttributes, RefCallback } from 'react';\nimport Touch, { TouchEvent, TouchEventHandler } from '../Touch/Touch';\nimport { getClassName } from '../../helpers/getClassName';\nimport { classNames } from '../../lib/classNames';\nimport { HasPlatform, HasRootRef } from '../../types';\nimport { setRef } from '../../lib/utils';\nimport { rescale } from '../../helpers/math';\nimport { withAdaptivity, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { withPlatform } from '../../hoc/withPlatform';\n\nexport type UniversalValue = [number | null, number];\n\nexport interface UniversalSliderProps<Value> extends\n  HasRootRef<HTMLDivElement>,\n  HasPlatform,\n  Omit<HTMLAttributes<HTMLDivElement>, 'value' | 'defaultValue' | 'onChange'>,\n  AdaptivityProps {\n  min?: number;\n  max?: number;\n  step?: number;\n  value?: Value;\n  defaultValue?: Value;\n  disabled?: boolean;\n  onChange?(value: Value, e: TouchEvent): void;\n}\n\nclass UniversalSliderDumb extends Component<UniversalSliderProps<UniversalValue>> {\n  dragging: false | 'start' | 'end' = false;\n  startX = 0;\n  containerWidth = 0;\n\n  container: HTMLDivElement;\n  thumbStart = createRef<HTMLDivElement>();\n  thumbEnd = createRef<HTMLDivElement>();\n\n  onStart: TouchEventHandler = (e: TouchEvent) => {\n    if (this.props.disabled) {\n      return;\n    }\n\n    const boundingRect = this.container.getBoundingClientRect();\n    this.containerWidth = boundingRect.width;\n\n    const absolutePosition = e.startX - boundingRect.left;\n    const value = this.offsetToValue(absolutePosition);\n    this.dragging = this.snapDirection(value, e.originalEvent.target);\n    this.startX = absolutePosition;\n\n    this.props.onChange(this.updateRange(value), e);\n    e.originalEvent.stopPropagation();\n  };\n\n  onMove: TouchEventHandler = (e: TouchEvent) => {\n    if (this.props.disabled) {\n      return;\n    }\n\n    const value = this.offsetToValue(this.startX + (e.shiftX || 0));\n    this.props.onChange(this.updateRange(value), e);\n\n    e.originalEvent.stopPropagation();\n    e.originalEvent.preventDefault();\n  };\n\n  onEnd: TouchEventHandler = (e) => {\n    if (this.props.disabled) {\n      return;\n    }\n\n    this.dragging = false;\n    e.originalEvent.stopPropagation();\n  };\n\n  updateRange(value: number): UniversalValue {\n    if (this.props.disabled) {\n      return this.props.value;\n    }\n\n    const [start, end] = this.props.value;\n\n    if (start == null) {\n      return [null, value];\n    }\n\n    const { dragging } = this;\n    if (dragging === 'start') {\n      if (value > end) {\n        // \"перехватиться\", если перетянули за конец\n        this.dragging = 'end';\n        return [end, value];\n      }\n      return [value, end];\n    }\n    if (dragging === 'end') {\n      if (value < start) {\n        // \"перехватиться\", если перетянули за начало\n        this.dragging = 'start';\n        return [value, start];\n      }\n      return [start, value];\n    }\n    return this.props.value;\n  };\n\n  offsetToValue(absolute: number) {\n    const { min, max, step } = this.props;\n    return rescale(absolute, [0, this.containerWidth], [min, max], { step });\n  }\n\n  snapDirection(value: number, target: EventTarget) {\n    if (target === this.thumbStart.current) {\n      return 'start';\n    }\n    if (target === this.thumbEnd.current) {\n      return 'end';\n    }\n    const [start, end] = this.props.value;\n    return Math.abs(start - value) <= Math.abs(end - value) ? 'start' : 'end';\n  }\n\n  getRef: RefCallback<HTMLDivElement> = (container) => {\n    this.container = container;\n    setRef(container, this.props.getRootRef);\n  };\n\n  render() {\n    const { min, max, step, value, defaultValue,\n      onChange, getRootRef, platform, sizeY, disabled, ...restProps } = this.props;\n    const toPercent = (v: number) => (v - min) / (max - min) * 100;\n\n    const isRange = value[0] != null;\n    const draggerStyle = isRange ? {\n      width: `${toPercent(value[1]) - toPercent(value[0])}%`,\n      left: isRange ? `${toPercent(value[0])}%` : null,\n    } : {\n      width: `${toPercent(value[1])}%`,\n    };\n\n    return (\n      <Touch\n        data-value={isRange ? value.join(',') : value}\n        {...restProps}\n        onStart={this.onStart}\n        onMove={this.onMove}\n        onEnd={this.onEnd}\n        vkuiClass={classNames(\n          getClassName('Slider', platform),\n          `Slider--sizeY-${sizeY}`,\n          disabled && 'Slider--disabled',\n        )}\n      >\n        <div ref={this.getRef} vkuiClass=\"Slider__in\">\n          <div vkuiClass=\"Slider__dragger\" style={draggerStyle}>\n            {isRange && <span vkuiClass={classNames('Slider__thumb', 'Slider__thumb--start')} ref={this.thumbStart} />}\n            <span vkuiClass={classNames('Slider__thumb', 'Slider__thumb--end')} ref={this.thumbEnd} />\n          </div>\n        </div>\n      </Touch>\n    );\n  }\n}\n\nexport const UniversalSlider = withAdaptivity(withPlatform(UniversalSliderDumb), {\n  sizeY: true,\n});\n"],"file":"UniversalSlider.js"}