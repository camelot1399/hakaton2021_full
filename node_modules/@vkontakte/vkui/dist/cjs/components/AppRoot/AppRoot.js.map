{"version":3,"sources":["../../../../src/components/AppRoot/AppRoot.tsx"],"names":["warn","AppRoot","children","_mode","mode","_embedded","embedded","sizeX","hasMouse","noLegacyClasses","scroll","props","rootRef","portalRoot","setPortalRoot","window","document","initialized","current","documentElement","classList","add","classScopingMode","noConflict","process","env","NODE_ENV","noop","portal","createElement","body","appendChild","parentElement","removeChild","parent","classes","concat","remove","SizeType","REGULAR","container","scrollController","content","appRoot"],"mappings":"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","sourcesContent":["import { FC, HTMLAttributes, useMemo, useRef, useState } from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '../../lib/classNames';\nimport { AppRootContext } from './AppRootContext';\nimport { withAdaptivity, SizeType, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { classScopingMode } from '../../lib/classScopingMode';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext, ScrollContextInterface } from './ScrollContext';\nimport { noop } from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends HTMLAttributes<HTMLDivElement>, AdaptivityProps {\n  /** @deprecated Use mode=\"embedded\" */\n  embedded?: boolean;\n  /** Режим встраивания */\n  mode?: 'partial' | 'embedded' | 'full';\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: 'global' | 'contain';\n}\n\nconst warn = warnOnce('AppRoot');\nconst AppRoot: FC<AppRootProps> = ({\n  children, mode: _mode, embedded: _embedded, sizeX, hasMouse, noLegacyClasses = false, scroll = 'global',\n  ...props\n}) => {\n  // normalize mode\n  const mode = _mode || (_embedded ? 'embedded' : 'full');\n\n  const rootRef = useRef<HTMLDivElement>();\n  const [portalRoot, setPortalRoot] = useState<HTMLDivElement>(null);\n  const { window, document } = useDOM();\n\n  const initialized = useRef(false);\n  if (!initialized.current) {\n    if (window && mode === 'full') {\n      document.documentElement.classList.add('vkui');\n    }\n    classScopingMode.noConflict = noLegacyClasses;\n    initialized.current = true;\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    if (scroll !== 'global' && mode !== 'embedded') {\n      warn('Scroll modes only supported in embedded mode');\n    }\n    if (_mode && _embedded) {\n      warn(`mode=\"${mode}\" overrides embedded`);\n    }\n  }\n\n  // setup portal\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'full') {\n      return noop;\n    }\n\n    const portal = document.createElement('div');\n    portal.classList.add('vkui__portal-root');\n    document.body.appendChild(portal);\n    setPortalRoot(portal);\n    return () => portal.parentElement.removeChild(portal);\n  }, []);\n\n  // setup root classes\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial') {\n      return noop;\n    }\n\n    const parent = rootRef.current.parentElement;\n    const classes = ['vkui__root'].concat(mode === 'embedded' ? 'vkui__root--embedded' : []);\n    parent.classList.add(...classes);\n\n    return () => {\n      parent.classList.remove(...classes);\n      if (mode === 'full') {\n        document.documentElement.classList.remove('vkui');\n      }\n    };\n  }, []);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial' || sizeX !== SizeType.REGULAR) {\n      return noop;\n    }\n    const container = mode === 'embedded' ? rootRef.current.parentElement : document.body;\n    container.classList.add('vkui--sizeX-regular');\n    return () => container.classList.remove('vkui--sizeX-regular');\n  }, [sizeX]);\n\n  const scrollController = useMemo<ScrollContextInterface>(\n    () => scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document),\n    [scroll]);\n\n  const content = (\n    <AppRootContext.Provider value={{\n      appRoot: rootRef,\n      portalRoot: portalRoot,\n      embedded: mode === 'embedded',\n    }}>\n      <ScrollContext.Provider value={scrollController}>\n        <IconSettingsProvider classPrefix=\"vkui\" globalClasses={!noLegacyClasses}>\n          {children}\n        </IconSettingsProvider>\n      </ScrollContext.Provider>\n    </AppRootContext.Provider>\n  );\n\n  return mode === 'partial' ? content : (\n    <div ref={rootRef} vkuiClass={classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse,\n    })} {...props}>\n      {content}\n    </div>\n  );\n};\n\nexport default withAdaptivity(AppRoot, {\n  sizeX: true,\n  hasMouse: true,\n});\n"],"file":"AppRoot.js"}