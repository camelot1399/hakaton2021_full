{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport { useMemo, useRef, useState } from 'react';\nimport { useDOM } from \"../../lib/dom\";\nimport { classNames } from \"../../lib/classNames\";\nimport { AppRootContext } from \"./AppRootContext\";\nimport { withAdaptivity, SizeType } from \"../../hoc/withAdaptivity\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { classScopingMode } from \"../../lib/classScopingMode\";\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext } from \"./ScrollContext\";\nimport { noop } from \"../../lib/utils\";\nimport { warnOnce } from \"../../lib/warnOnce\"; // Используйте classList, но будьте осторожны\n\n/* eslint-disable no-restricted-properties */\n\nvar warn = warnOnce('AppRoot');\n\nvar AppRoot = function AppRoot(_ref) {\n  var children = _ref.children,\n      _mode = _ref.mode,\n      _embedded = _ref.embedded,\n      sizeX = _ref.sizeX,\n      hasMouse = _ref.hasMouse,\n      _ref$noLegacyClasses = _ref.noLegacyClasses,\n      noLegacyClasses = _ref$noLegacyClasses === void 0 ? false : _ref$noLegacyClasses,\n      _ref$scroll = _ref.scroll,\n      scroll = _ref$scroll === void 0 ? 'global' : _ref$scroll,\n      props = _objectWithoutProperties(_ref, [\"children\", \"mode\", \"embedded\", \"sizeX\", \"hasMouse\", \"noLegacyClasses\", \"scroll\"]); // normalize mode\n\n\n  var mode = _mode || (_embedded ? 'embedded' : 'full');\n  var rootRef = useRef();\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      portalRoot = _useState2[0],\n      setPortalRoot = _useState2[1];\n\n  var _useDOM = useDOM(),\n      window = _useDOM.window,\n      document = _useDOM.document;\n\n  var initialized = useRef(false);\n\n  if (!initialized.current) {\n    if (window && mode === 'full') {\n      document.documentElement.classList.add('vkui');\n    }\n\n    classScopingMode.noConflict = noLegacyClasses;\n    initialized.current = true;\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    if (scroll !== 'global' && mode !== 'embedded') {\n      warn('Scroll modes only supported in embedded mode');\n    }\n\n    if (_mode && _embedded) {\n      warn(\"mode=\\\"\".concat(mode, \"\\\" overrides embedded\"));\n    }\n  } // setup portal\n\n\n  useIsomorphicLayoutEffect(function () {\n    if (mode === 'full') {\n      return noop;\n    }\n\n    var portal = document.createElement('div');\n    portal.classList.add('vkui__portal-root');\n    document.body.appendChild(portal);\n    setPortalRoot(portal);\n    return function () {\n      return portal.parentElement.removeChild(portal);\n    };\n  }, []); // setup root classes\n\n  useIsomorphicLayoutEffect(function () {\n    var _parent$classList;\n\n    if (mode === 'partial') {\n      return noop;\n    }\n\n    var parent = rootRef.current.parentElement;\n    var classes = ['vkui__root'].concat(mode === 'embedded' ? 'vkui__root--embedded' : []);\n\n    (_parent$classList = parent.classList).add.apply(_parent$classList, _toConsumableArray(classes));\n\n    return function () {\n      var _parent$classList2;\n\n      (_parent$classList2 = parent.classList).remove.apply(_parent$classList2, _toConsumableArray(classes));\n\n      if (mode === 'full') {\n        document.documentElement.classList.remove('vkui');\n      }\n    };\n  }, []); // adaptivity handler\n\n  useIsomorphicLayoutEffect(function () {\n    if (mode === 'partial' || sizeX !== SizeType.REGULAR) {\n      return noop;\n    }\n\n    var container = mode === 'embedded' ? rootRef.current.parentElement : document.body;\n    container.classList.add('vkui--sizeX-regular');\n    return function () {\n      return container.classList.remove('vkui--sizeX-regular');\n    };\n  }, [sizeX]);\n  var scrollController = useMemo(function () {\n    return scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document);\n  }, [scroll]);\n  var content = createScopedElement(AppRootContext.Provider, {\n    value: {\n      appRoot: rootRef,\n      portalRoot: portalRoot,\n      embedded: mode === 'embedded'\n    }\n  }, createScopedElement(ScrollContext.Provider, {\n    value: scrollController\n  }, createScopedElement(IconSettingsProvider, {\n    classPrefix: \"vkui\",\n    globalClasses: !noLegacyClasses\n  }, children)));\n  return mode === 'partial' ? content : createScopedElement(\"div\", _extends({\n    ref: rootRef,\n    vkuiClass: classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse\n    })\n  }, props), content);\n};\n\nexport default withAdaptivity(AppRoot, {\n  sizeX: true,\n  hasMouse: true\n});","map":{"version":3,"sources":["../../../src/components/AppRoot/AppRoot.tsx"],"names":["warn","warnOnce","AppRoot","children","mode","_mode","embedded","_embedded","sizeX","hasMouse","noLegacyClasses","scroll","props","rootRef","useRef","portalRoot","setPortalRoot","useState","window","document","useDOM","initialized","classScopingMode","process","useIsomorphicLayoutEffect","portal","parent","classes","SizeType","container","scrollController","useMemo","elementScrollController","globalScrollController","content","appRoot","classNames","withAdaptivity"],"mappings":"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","sourcesContent":["import { FC, HTMLAttributes, useMemo, useRef, useState } from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '../../lib/classNames';\nimport { AppRootContext } from './AppRootContext';\nimport { withAdaptivity, SizeType, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { classScopingMode } from '../../lib/classScopingMode';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext, ScrollContextInterface } from './ScrollContext';\nimport { noop } from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends HTMLAttributes<HTMLDivElement>, AdaptivityProps {\n  /** @deprecated Use mode=\"embedded\" */\n  embedded?: boolean;\n  /** Режим встраивания */\n  mode?: 'partial' | 'embedded' | 'full';\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: 'global' | 'contain';\n}\n\nconst warn = warnOnce('AppRoot');\nconst AppRoot: FC<AppRootProps> = ({\n  children, mode: _mode, embedded: _embedded, sizeX, hasMouse, noLegacyClasses = false, scroll = 'global',\n  ...props\n}) => {\n  // normalize mode\n  const mode = _mode || (_embedded ? 'embedded' : 'full');\n\n  const rootRef = useRef<HTMLDivElement>();\n  const [portalRoot, setPortalRoot] = useState<HTMLDivElement>(null);\n  const { window, document } = useDOM();\n\n  const initialized = useRef(false);\n  if (!initialized.current) {\n    if (window && mode === 'full') {\n      document.documentElement.classList.add('vkui');\n    }\n    classScopingMode.noConflict = noLegacyClasses;\n    initialized.current = true;\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    if (scroll !== 'global' && mode !== 'embedded') {\n      warn('Scroll modes only supported in embedded mode');\n    }\n    if (_mode && _embedded) {\n      warn(`mode=\"${mode}\" overrides embedded`);\n    }\n  }\n\n  // setup portal\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'full') {\n      return noop;\n    }\n\n    const portal = document.createElement('div');\n    portal.classList.add('vkui__portal-root');\n    document.body.appendChild(portal);\n    setPortalRoot(portal);\n    return () => portal.parentElement.removeChild(portal);\n  }, []);\n\n  // setup root classes\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial') {\n      return noop;\n    }\n\n    const parent = rootRef.current.parentElement;\n    const classes = ['vkui__root'].concat(mode === 'embedded' ? 'vkui__root--embedded' : []);\n    parent.classList.add(...classes);\n\n    return () => {\n      parent.classList.remove(...classes);\n      if (mode === 'full') {\n        document.documentElement.classList.remove('vkui');\n      }\n    };\n  }, []);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial' || sizeX !== SizeType.REGULAR) {\n      return noop;\n    }\n    const container = mode === 'embedded' ? rootRef.current.parentElement : document.body;\n    container.classList.add('vkui--sizeX-regular');\n    return () => container.classList.remove('vkui--sizeX-regular');\n  }, [sizeX]);\n\n  const scrollController = useMemo<ScrollContextInterface>(\n    () => scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document),\n    [scroll]);\n\n  const content = (\n    <AppRootContext.Provider value={{\n      appRoot: rootRef,\n      portalRoot: portalRoot,\n      embedded: mode === 'embedded',\n    }}>\n      <ScrollContext.Provider value={scrollController}>\n        <IconSettingsProvider classPrefix=\"vkui\" globalClasses={!noLegacyClasses}>\n          {children}\n        </IconSettingsProvider>\n      </ScrollContext.Provider>\n    </AppRootContext.Provider>\n  );\n\n  return mode === 'partial' ? content : (\n    <div ref={rootRef} vkuiClass={classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse,\n    })} {...props}>\n      {content}\n    </div>\n  );\n};\n\nexport default withAdaptivity(AppRoot, {\n  sizeX: true,\n  hasMouse: true,\n});\n"]},"metadata":{},"sourceType":"module"}